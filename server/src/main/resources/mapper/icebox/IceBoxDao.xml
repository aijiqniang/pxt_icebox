<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.szeastroc.icebox.newprocess.dao.IceBoxDao">
    <resultMap id="BaseResultMap" type="com.szeastroc.icebox.newprocess.entity.IceBox">
        <!--@mbg.generated-->
        <!--@Table t_ice_box-->
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="chest_name" jdbcType="VARCHAR" property="chestName"/>
        <result column="model_id" jdbcType="INTEGER" property="modelId"/>
        <result column="brand_name" jdbcType="VARCHAR" property="brandName"/>
        <result column="chest_norm" jdbcType="VARCHAR" property="chestNorm"/>
        <result column="chest_money" jdbcType="DECIMAL" property="chestMoney"/>
        <result column="deposit_money" jdbcType="DECIMAL" property="depositMoney"/>
        <result column="supplier_id" jdbcType="INTEGER" property="supplierId"/>
        <result column="put_store_number" jdbcType="VARCHAR" property="putStoreNumber"/>
        <result column="dept_id" jdbcType="INTEGER" property="deptId"/>
        <result column="remark" jdbcType="VARCHAR" property="remark"/>
        <result column="put_status" jdbcType="TINYINT" property="putStatus"/>
        <result column="status" jdbcType="TINYINT" property="status"/>
        <result column="created_by" jdbcType="INTEGER" property="createdBy"/>
        <result column="created_time" jdbcType="TIMESTAMP" property="createdTime"/>
        <result column="updated_by" jdbcType="INTEGER" property="updatedBy"/>
        <result column="updated_time" jdbcType="TIMESTAMP" property="updatedTime"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--@mbg.generated-->
        id, chest_name, model_id, brand_name, chest_norm, chest_money, deposit_money, supplier_id,
        put_store_number, dept_id, remark, put_status, `status`, created_by, created_time,
        updated_by, updated_time
    </sql>

    <select id="findPage" resultType="com.szeastroc.icebox.newprocess.entity.IceBox">
        SELECT b.* FROM `t_ice_box` b INNER JOIN `t_ice_box_extend` be
        ON b.`id`=be.`id`
        <trim prefix="WHERE" prefixOverrides="AND |OR ">
            <if test="bluetoothId!=null and bluetoothId!=''">
                and be.bluetooth_id like CONCAT('%',#{bluetoothId},'%')
            </if>
            <if test="status!=null">
                and b.status=#{status}
            </if>
            -- 所在对象 (put_status 投放状态 0: 未投放 1:已锁定(被业务员申请) 2:投放中 3:已投放; 当经销商时为 0-未投放;当门店时为非未投放状态;)
            <if test="belongObj!=null and belongObj==0 and supplierIdList!=null and supplierIdList.size>0">
                and b.put_status=0 and b.supplier_id in
                <foreach item="item" index="index" collection="supplierIdList" open="("
                         separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="belongObj!=null and belongObj!=0 and putStoreNumberList!=null and putStoreNumberList.size>0">
                and b.put_status!=0 and b.put_store_number in
                <foreach item="item" index="index" collection="putStoreNumberList" open="("
                         separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="deptIds!=null and deptIds.size>0">
                and b.dept_id in
                <foreach item="item" index="index" collection="deptIds" open="("
                         separator="," close=")">
                    #{item}
                </foreach>
            </if>
        </trim>
    </select>

</mapper>